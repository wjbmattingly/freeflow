{% extends "base.html" %}

{% block title %}Projects - FreeFlow{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Projects</h1>
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary" id="importProjectBtn" title="Import Projects">ðŸ“¥ Import</button>
            <button class="btn btn-secondary" id="exportProjectBtn" title="Export Projects">ðŸ“¤ Export</button>
            <button class="btn btn-primary" id="newProjectBtn">+ New Project</button>
        </div>
    </div>

    <div class="search-bar">
        <input type="text" id="searchProjects" placeholder="Search projects">
        <select id="sortBy">
            <option value="date_edited">Sort: Date Edited</option>
            <option value="date_created">Sort: Date Created</option>
            <option value="name">Sort: Name</option>
        </select>
    </div>

    <div id="projectsGrid" class="projects-grid">
        <!-- Projects will be loaded here -->
    </div>
</div>

<!-- Create Project Modal -->
<div id="createProjectModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2>Let's create your project.</h2>
            <button class="close-btn" id="closeProjectModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-grid">
                <div class="form-group">
                    <label>Project Name</label>
                    <input type="text" id="projectName" placeholder='E.g., "Dog Breeds" or "Car Models"'>
                </div>
                <div class="form-group">
                    <label>Annotation Group</label>
                    <input type="text" id="annotationGroup" placeholder='E.g., "dogs" or "cars" or "words"'>
                </div>
            </div>

            <div class="project-types">
                <h3>Project Type</h3>
                
                <div class="project-type-card active" data-type="object_detection">
                    <div class="type-header">
                        <h4>Object Detection</h4>
                        <div class="type-badges">
                            <span class="badge">Bounding Boxes</span>
                            <span class="badge">Counts</span>
                            <span class="badge">Tracking</span>
                        </div>
                    </div>
                    <p>Identify objects and their positions with bounding boxes.</p>
                </div>

                <div class="project-type-card" data-type="classification">
                    <div class="type-header">
                        <h4>Classification</h4>
                        <div class="type-badges">
                            <span class="badge">Image Labels</span>
                            <span class="badge">Filtering</span>
                        </div>
                    </div>
                    <p>Assign labels to the entire image.</p>
                </div>

                <div class="project-type-card" data-type="segmentation">
                    <div class="type-header">
                        <h4>Instance Segmentation</h4>
                        <div class="type-badges">
                            <span class="badge">Polygons</span>
                            <span class="badge">Measuring</span>
                        </div>
                    </div>
                    <p>Detect multiple objects and their actual shape.</p>
                </div>
            </div>

            <div class="classes-section">
                <h3>Classes</h3>
                <div id="classesList">
                    <div class="class-item">
                        <input type="text" class="class-name-input" placeholder="Class name" value="object">
                        <input type="color" class="class-color-input" value="#FF6B6B">
                        <button class="btn-icon remove-class-btn">âœ•</button>
                    </div>
                </div>
                <button class="btn btn-secondary" id="addClassBtn">+ Add Class</button>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelProjectBtn">Cancel</button>
                <button class="btn btn-primary" id="createProjectBtn">Create Public Project</button>
            </div>
        </div>
    </div>
</div>

<!-- Export Projects Modal -->
<div id="exportProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Export Projects</h2>
            <button class="close-btn" id="closeExportModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <p>Select projects to export as a zip file. The export will include all data, annotations, datasets, and trained models.</p>
            
            <div style="margin: 1.5rem 0;">
                <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="checkbox" id="selectAllProjects" style="width: auto;">
                    <span style="font-weight: 600;">Select All Projects</span>
                </label>
                
                <div id="exportProjectsList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem;">
                    <!-- Projects will be loaded here -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmExportBtn">ðŸ“¤ Export Selected</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Projects Modal -->
<div id="importProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Import Projects</h2>
            <button class="close-btn" id="closeImportModalBtn">&times;</button>
        </div>
        <div class="modal-body">
            <p>Upload a FreeFlow export zip file to import projects with all their data.</p>
            
            <div style="margin: 1.5rem 0;">
                <div class="form-group">
                    <label>Select Export Zip File</label>
                    <input type="file" id="importFileInput" accept=".zip" style="width: 100%; padding: 0.75rem; border: 2px dashed var(--border-color); border-radius: 8px; cursor: pointer;">
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                    <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">
                        <strong>Note:</strong> Imported projects will be renamed with an "(Imported)" suffix to avoid conflicts with existing projects.
                    </p>
                </div>
                
                <div id="importProgress" style="display: none; margin-top: 1rem;">
                    <div class="progress-bar" style="width: 100%; height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden;">
                        <div id="importProgressFill" style="width: 0%; height: 100%; background: var(--accent-primary); transition: width 0.3s;"></div>
                    </div>
                    <p id="importStatus" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);"></p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmImportBtn">ðŸ“¥ Import Projects</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/projects.js') }}"></script>
{% endblock %}

